<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meds-app - Gesti√≥n Completa de Medicamentos</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;background:#f0f8ff;color:#333;line-height:1.6}
.container{max-width:900px;margin:0 auto;padding:20px}
.header{background:linear-gradient(135deg,#2563EB,#1E3A8A);color:white;padding:30px;border-radius:20px;text-align:center;margin-bottom:30px;box-shadow:0 6px 20px rgba(0,0,0,0.2)}
.header h1{font-size:2.8em;margin-bottom:10px}
.header p{font-size:1.3em;opacity:0.9}
.stats{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin:30px 0}
.stat-card{background:white;padding:25px;border-radius:15px;text-align:center;box-shadow:0 4px 12px rgba(0,0,0,0.1);transition:transform 0.3s}
.stat-card:hover{transform:translateY(-5px)}
.stat-number{font-size:2.8em;font-weight:bold;color:#2563EB;margin-bottom:8px}
.medication-card{background:white;padding:25px;border-radius:15px;margin:15px 0;box-shadow:0 4px 12px rgba(0,0,0,0.1);display:flex;justify-content:space-between;align-items:flex-start}
.med-info{flex:1}
.med-name{font-size:1.4em;font-weight:bold;color:#2563EB;margin-bottom:8px}
.med-dose{color:#666;font-size:1.1em;margin-bottom:5px}
.med-time{color:#10b981;font-weight:bold;background:#ecfdf5;padding:5px 10px;border-radius:20px;font-size:0.9em;margin:5px 0}
.btn{background:#2563EB;color:white;border:none;padding:15px 25px;border-radius:12px;cursor:pointer;font-size:1.1em;font-weight:bold;transition:all 0.3s;margin:5px}
.btn:hover{background:#1e40af;transform:translateY(-2px);box-shadow:0 4px 12px rgba(37,99,235,0.3)}
.btn-success{background:#10b981}
.btn-success:hover{background:#059669}
.btn-danger{background:#dc2626}
.btn-danger:hover{background:#b91c1c}
.btn-warning{background:#f59e0b}
.btn-warning:hover{background:#d97706}
.btn-secondary{background:#6b7280}
.btn-secondary:hover{background:#4b5563}
.add-btn{background:linear-gradient(135deg,#10b981,#059669);padding:20px 40px;font-size:1.4em;display:block;margin:30px auto;border-radius:15px;box-shadow:0 6px 20px rgba(16,185,129,0.3)}
.nav{position:fixed;bottom:0;left:0;right:0;background:white;padding:15px;display:flex;justify-content:space-around;box-shadow:0 -4px 15px rgba(0,0,0,0.15);z-index:1000}
.nav-btn{background:none;border:none;padding:12px;cursor:pointer;text-align:center;color:#666;border-radius:12px;transition:all 0.3s;min-width:80px}
.nav-btn.active{color:#2563EB;font-weight:bold;background:#e0f2fe;transform:translateY(-3px)}
.nav-btn:hover{background:#f0f9ff;color:#2563EB}
.nav-btn i{font-size:1.4em;display:block;margin-bottom:5px}
.content-section{display:none}
.content-section.active{display:block}
.section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;flex-wrap:wrap;gap:20px}
.section-header h2{color:#2563EB;font-size:2.2em}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:2000}
.modal.active{display:flex;align-items:center;justify-content:center}
.modal-content{background:white;padding:40px;border-radius:25px;max-width:500px;width:90%;box-shadow:0 15px 35px rgba(0,0,0,0.2);animation:modalSlideIn 0.3s ease-out}
@keyframes modalSlideIn{from{opacity:0;transform:translateY(-50px) scale(0.9)}to{opacity:1;transform:translateY(0) scale(1)}}
.modal-content h3{color:#2563EB;font-size:1.8em;margin-bottom:25px;text-align:center}
.form-group{margin:25px 0}
.form-group label{display:block;margin-bottom:10px;font-weight:bold;color:#2563EB;font-size:1.1em}
.form-group input,.form-group textarea,.form-group select{width:100%;padding:15px;border:2px solid #ddd;border-radius:12px;font-size:1.1em;transition:border-color 0.3s}
.form-group input:focus,.form-group textarea:focus,.form-group select:focus{border-color:#2563EB;outline:none;box-shadow:0 0 0 3px rgba(37,99,235,0.1)}
.modal-buttons{display:flex;gap:15px;justify-content:center;margin-top:30px}
.taken{background:#dcfce7;border-left:5px solid #10b981}
.taken .btn{display:none}
.taken .med-name{color:#10b981}
.medications-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px}
.medication-grid-card{background:white;padding:25px;border-radius:15px;box-shadow:0 4px 12px rgba(0,0,0,0.1)}
.medication-actions{display:flex;gap:10px;margin-top:15px}
.filter-btn{background:white;border:2px solid #ddd;color:#666;padding:10px 20px;border-radius:8px;cursor:pointer;transition:all 0.3s}
.filter-btn.active,.filter-btn:hover{background:#2563EB;color:white;border-color:#2563EB}
.contact-card{background:white;padding:20px;border-radius:12px;margin:10px 0;box-shadow:0 2px 8px rgba(0,0,0,0.1);display:flex;justify-content:space-between;align-items:center}
.contact-info{flex:1}
.contact-name{font-weight:bold;color:#2563EB;margin-bottom:5px}
.contact-phone{color:#666}
.contact-relationship{color:#10b981;font-size:0.9em}
.contact-actions{display:flex;gap:10px}
.emergency-section{background:linear-gradient(135deg,#dc2626,#b91c1c);color:white;padding:30px;border-radius:20px;text-align:center;margin:20px 0}
.emergency-btn{background:#fff;color:#dc2626;border:none;padding:20px 40px;border-radius:50px;font-size:1.3em;font-weight:bold;cursor:pointer;animation:pulse 2s infinite}
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}
.sos-btn{position:fixed;top:20px;right:20px;background:#dc2626;color:white;border:none;padding:15px 20px;border-radius:50px;font-weight:bold;z-index:1001;box-shadow:0 4px 15px rgba(220,38,38,0.4);cursor:pointer}
.sos-btn:hover{background:#b91c1c;transform:scale(1.1)}
.toast{position:fixed;top:20px;right:20px;background:#10b981;color:white;padding:20px 25px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.2);z-index:3000;display:flex;align-items:center;gap:15px;font-weight:bold;animation:toastSlideIn 0.3s}
.toast.error{background:#dc2626}
@keyframes toastSlideIn{from{opacity:0;transform:translateX(100%)}to{opacity:1;transform:translateX(0)}}
.chart-container{background:white;padding:30px;border-radius:15px;box-shadow:0 4px 12px rgba(0,0,0,0.1);margin:20px 0;max-height:400px;overflow:hidden}
.empty-state{text-align:center;padding:60px;color:#666}
.empty-state i{font-size:4em;margin-bottom:20px;color:#ddd}
.profile-form{background:white;padding:30px;border-radius:15px;box-shadow:0 4px 12px rgba(0,0,0,0.1)}
.tabs{display:flex;background:#f3f4f6;border-radius:12px;padding:5px;margin-bottom:25px}
.tab-btn{flex:1;background:none;border:none;padding:15px;border-radius:8px;cursor:pointer;transition:all 0.3s}
.tab-btn.active{background:#2563EB;color:white}
.tab-content{display:none}
.tab-content.active{display:block}

/* INDICADOR DE ESTADO */
.status-indicator{position:fixed;top:5px;left:5px;background:#10b981;color:white;padding:8px 12px;border-radius:5px;font-size:12px;z-index:9999;opacity:0.9}
@media(max-width:768px){.container{padding:15px}.stats{grid-template-columns:1fr}.medication-card{flex-direction:column;text-align:center}.med-info{margin-bottom:15px}.nav{justify-content:space-around}.modal-content{padding:25px}.sos-btn{top:10px;right:10px;padding:12px 15px}}
</style>
</head>
<body>
<div id="status-indicator" class="status-indicator">üîÑ Iniciando...</div>

<button id="sos-button" class="sos-btn">
    <i class="fas fa-exclamation-triangle"></i> SOS
</button>

<div class="container">
    <div class="header">
        <h1><i class="fas fa-pills"></i> Meds-app</h1>
        <p>Gesti√≥n Completa de Medicamentos para Personas Mayores</p>
    </div>
    
    <!-- SECCI√ìN HOY -->
    <section id="today-section" class="content-section active">
        <div class="section-header">
            <h2><i class="fas fa-calendar-day"></i> Medicamentos de Hoy</h2>
            <p id="today-date" style="color:#666;font-size:1.2em"></p>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="taken-count">0</div>
                <div>Medicamentos Tomados</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="pending-count">3</div>
                <div>Por Tomar</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="missed-count">0</div>
                <div>Perdidos</div>
            </div>
        </div>
        
        <div id="today-medications-list">
            <!-- Se carga din√°micamente -->
        </div>
    </section>

    <!-- SECCI√ìN MEDICINAS -->
    <section id="medicines-section" class="content-section">
        <div class="section-header">
            <h2><i class="fas fa-pills"></i> Mis Medicamentos</h2>
            <button id="add-medication-btn" class="btn add-btn">
                <i class="fas fa-plus"></i> Agregar Medicamento
            </button>
        </div>
        
        <div class="medications-filters" style="margin-bottom:25px">
            <button class="filter-btn active" data-filter="all">Todos</button>
            <button class="filter-btn" data-filter="active">Activos</button>
            <button class="filter-btn" data-filter="expiring">Por Vencer</button>
            <button class="filter-btn" data-filter="expired">Vencidos</button>
        </div>
        
        <div id="medicines-grid" class="medications-grid">
            <!-- Se carga din√°micamente -->
        </div>
    </section>

    <!-- SECCI√ìN REPORTES -->
    <section id="reports-section" class="content-section">
        <div class="section-header">
            <h2><i class="fas fa-chart-line"></i> Reportes y Estad√≠sticas</h2>
        </div>
        
        <div class="chart-container">
            <h3 style="margin-bottom:20px;color:#2563EB">Adherencia al Tratamiento</h3>
            <div id="adherence-text">
                <!-- Se carga din√°micamente -->
            </div>
        </div>
        
        <div class="chart-container">
            <h3 style="margin-bottom:20px;color:#2563EB">Medicamentos Tomados Esta Semana</h3>
            <div id="weekly-stats">
                <!-- Se carga din√°micamente -->
            </div>
        </div>
        
        <div class="chart-container">
            <h3 style="margin-bottom:20px;color:#2563EB">Alertas Importantes</h3>
            <div id="alerts-list">
                <!-- Se carga din√°micamente -->
            </div>
        </div>
    </section>

    <!-- SECCI√ìN PERFIL -->
    <section id="profile-section" class="content-section">
        <div class="section-header">
            <h2><i class="fas fa-user"></i> Mi Perfil</h2>
        </div>
        
        <div class="profile-form">
            <div class="tabs">
                <button class="tab-btn active" data-tab="patient-info">Informaci√≥n Personal</button>
                <button class="tab-btn" data-tab="emergency-contacts">Contactos de Emergencia</button>
                <button class="tab-btn" data-tab="medical-contacts">Contactos M√©dicos</button>
                <button class="tab-btn" data-tab="family-tracking">Seguimiento Familiar</button>
            </div>
            
            <div id="patient-info-tab" class="tab-content active">
                <h3 style="margin-bottom:20px;color:#2563EB">Informaci√≥n Personal</h3>
                <form id="patient-form">
                    <div class="form-group">
                        <label for="patient-name">Nombre Completo</label>
                        <input type="text" id="patient-name" placeholder="Ej: Mar√≠a Gonz√°lez">
                    </div>
                    <div class="form-group">
                        <label for="patient-age">Edad</label>
                        <input type="number" id="patient-age" placeholder="Ej: 65">
                    </div>
                    <div class="form-group">
                        <label for="patient-conditions">Condiciones M√©dicas</label>
                        <textarea id="patient-conditions" placeholder="Ej: Diabetes tipo 2, Hipertensi√≥n" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Guardar Informaci√≥n
                    </button>
                </form>
            </div>
            
            <div id="emergency-contacts-tab" class="tab-content">
                <h3 style="margin-bottom:20px;color:#2563EB">Contactos de Emergencia</h3>
                <div id="emergency-contacts-list">
                    <!-- Se carga din√°micamente -->
                </div>
                <button id="add-emergency-contact-btn" class="btn add-btn">
                    <i class="fas fa-plus"></i> Agregar Contacto de Emergencia
                </button>
            </div>
            
            <div id="medical-contacts-tab" class="tab-content">
                <h3 style="margin-bottom:20px;color:#2563EB">Contactos M√©dicos</h3>
                <div id="medical-contacts-list">
                    <!-- Se carga din√°micamente -->
                </div>
                <button id="add-medical-contact-btn" class="btn add-btn">
                    <i class="fas fa-plus"></i> Agregar Contacto M√©dico
                </button>
            </div>
            
            <div id="family-tracking-tab" class="tab-content">
                <h3 style="margin-bottom:20px;color:#2563EB">Seguimiento Familiar</h3>
                <p style="margin-bottom:20px;color:#666">Comparte tu progreso con familiares de confianza</p>
                <div id="family-contacts-list">
                    <!-- Se carga din√°micamente -->
                </div>
                <button id="add-family-contact-btn" class="btn add-btn">
                    <i class="fas fa-plus"></i> Agregar Familiar
                </button>
            </div>
        </div>
    </section>
</div>

<div class="nav">
    <button class="nav-btn active" data-section="today">
        <i class="fas fa-calendar-day"></i>
        <div>Hoy</div>
    </button>
    <button class="nav-btn" data-section="medicines">
        <i class="fas fa-pills"></i>
        <div>Medicinas</div>
    </button>
    <button class="nav-btn" data-section="reports">
        <i class="fas fa-chart-line"></i>
        <div>Reportes</div>
    </button>
    <button class="nav-btn" data-section="profile">
        <i class="fas fa-user"></i>
        <div>Perfil</div>
    </button>
</div>

<!-- MODALES -->
<!-- Agregar Medicamento -->
<div id="add-medication-modal" class="modal">
    <div class="modal-content">
        <h3><i class="fas fa-plus"></i> Agregar Medicamento</h3>
        <form id="medication-form">
            <div class="form-group">
                <label for="med-name">Nombre del Medicamento</label>
                <input type="text" id="med-name" placeholder="Ej: Ibuprofeno" required>
            </div>
            <div class="form-group">
                <label for="med-dose">Dosis</label>
                <input type="text" id="med-dose" placeholder="Ej: 400mg" required>
            </div>
            <div class="form-group">
                <label for="med-frequency">Frecuencia</label>
                <select id="med-frequency" required>
                    <option value="">Seleccionar...</option>
                    <option value="daily">Diario</option>
                    <option value="twice-daily">Dos veces al d√≠a</option>
                    <option value="weekly">Semanal</option>
                    <option value="as-needed">Seg√∫n necesidad</option>
                </select>
            </div>
            <div class="form-group">
                <label for="med-time">Hora</label>
                <input type="time" id="med-time" required>
            </div>
            <div class="form-group">
                <label for="med-instructions">Instrucciones</label>
                <textarea id="med-instructions" placeholder="Ej: Tomar con comida" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label for="med-expiry">Fecha de Vencimiento (Opcional)</label>
                <input type="date" id="med-expiry">
            </div>
            <div class="modal-buttons">
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save"></i> Guardar
                </button>
                <button type="button" id="cancel-medication-btn" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Cancelar
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Agregar Contacto -->
<div id="add-contact-modal" class="modal">
    <div class="modal-content">
        <h3 id="contact-modal-title"><i class="fas fa-plus"></i> Agregar Contacto</h3>
        <form id="contact-form">
            <div class="form-group">
                <label for="contact-name">Nombre</label>
                <input type="text" id="contact-name" placeholder="Ej: Dr. Juan P√©rez" required>
            </div>
            <div class="form-group">
                <label for="contact-phone">Tel√©fono</label>
                <input type="tel" id="contact-phone" placeholder="Ej: +1234567890" required>
            </div>
            <div class="form-group">
                <label for="contact-relationship">Relaci√≥n</label>
                <select id="contact-relationship" required>
                    <option value="">Seleccionar...</option>
                    <option value="family">Familiar</option>
                    <option value="friend">Amigo</option>
                    <option value="doctor">Doctor</option>
                    <option value="nurse">Enfermera</option>
                    <option value="pharmacy">Farmacia</option>
                    <option value="other">Otro</option>
                </select>
            </div>
            <div class="form-group">
                <label for="contact-notes">Notas Adicionales</label>
                <textarea id="contact-notes" placeholder="Ej: M√©dico de cabecera" rows="3"></textarea>
            </div>
            <div class="modal-buttons">
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save"></i> Guardar
                </button>
                <button type="button" id="cancel-contact-btn" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Cancelar
                </button>
            </div>
        </form>
    </div>
</div>

<!-- SOS Modal -->
<div id="sos-modal" class="modal">
    <div class="modal-content">
        <div class="emergency-section">
            <h2><i class="fas fa-exclamation-triangle"></i> EMERGENCIA</h2>
            <p>Selecciona un contacto para llamar</p>
        </div>
        <div id="sos-contacts-list" style="margin-top:20px">
            <!-- Se carga din√°micamente -->
        </div>
        <div style="text-align:center;margin-top:25px">
            <button id="call-911-btn" class="btn emergency-btn">
                <i class="fas fa-phone"></i> Llamar 911
            </button>
        </div>
        <div style="text-align:center;margin-top:15px">
            <button id="cancel-sos-btn" class="btn btn-secondary">
                <i class="fas fa-times"></i> Cancelar
            </button>
        </div>
    </div>
</div>

<script>
// ESTADO DE LA APLICACI√ìN
let appData = {
    medications: [
        { 
            id: 'metformin', 
            name: 'Metformin', 
            dose: '500mg', 
            frequency: 'daily',
            time: '08:00',
            instructions: 'Tomar con comida', 
            taken: false,
            expiry: '2025-06-15'
        },
        { 
            id: 'amlodipine', 
            name: 'Amlodipine', 
            dose: '5mg', 
            frequency: 'daily',
            time: '09:00',
            instructions: 'Tomar por la ma√±ana', 
            taken: false,
            expiry: '2025-08-20'
        },
        { 
            id: 'vitamin', 
            name: 'Vitamin D3', 
            dose: '1000 IU', 
            frequency: 'daily',
            time: '12:00',
            instructions: 'Tomar con almuerzo', 
            taken: false,
            expiry: '2025-05-30'
        }
    ],
    contacts: {
        emergency: [
            { id: '1', name: 'Mar√≠a Gonz√°lez', phone: '+1234567890', relationship: 'Hija', notes: 'Contacto principal' },
            { id: '2', name: 'Dr. Juan P√©rez', phone: '+1234567891', relationship: 'doctor', notes: 'M√©dico de cabecera' }
        ],
        medical: [
            { id: '1', name: 'Dr. Juan P√©rez', phone: '+1234567891', relationship: 'doctor', notes: 'M√©dico de cabecera' },
            { id: '2', name: 'Farmacia Central', phone: '+1234567892', relationship: 'pharmacy', notes: 'Farmacia m√°s cercana' }
        ],
        family: [
            { id: '1', name: 'Carlos Gonz√°lez', phone: '+1234567893', relationship: 'family', notes: 'Puede ver reportes' }
        ]
    },
    patient: {
        name: 'Usuario Demo',
        age: '65',
        conditions: 'Diabetes tipo 2, Hipertensi√≥n'
    }
};

let currentFilter = 'all';
let currentContactType = 'emergency';

// UTILIDADES
function updateStatus(message) {
    const statusEl = document.getElementById('status-indicator');
    if (statusEl) {
        statusEl.textContent = message;
    }
}

function showToast(message, type = 'success') {
    const existingToast = document.querySelector('.toast');
    if (existingToast) {
        existingToast.remove();
    }
    
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'}"></i>
        <span>${message}</span>
    `;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 3000);
}

// FUNCIONES PRINCIPALES
function switchSection(sectionName) {
    updateStatus(`Cambiando a: ${sectionName}`);
    
    // Actualizar botones de navegaci√≥n
    document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');
    
    // Mostrar secci√≥n
    document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
    document.getElementById(`${sectionName}-section`).classList.add('active');
    
    // Actualizar contenido espec√≠fico
    switch(sectionName) {
        case 'today':
            updateTodayView();
            break;
        case 'medicines':
            updateMedicinesView();
            break;
        case 'reports':
            updateReportsView();
            break;
        case 'profile':
            updateProfileView();
            break;
    }
    
    updateStatus('‚úÖ Secci√≥n actualizada');
}

function takeMedication(id) {
    const med = appData.medications.find(m => m.id === id);
    if (med && !med.taken) {
        med.taken = true;
        med.takenAt = new Date().toLocaleTimeString();
        
        showToast(`¬°Excelente! Has tomado ${med.name}`, 'success');
        updateTodayView();
        saveData();
    }
}

function showModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.classList.add('active');
        updateStatus(`Modal abierto: ${modalId}`);
    }
}

function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.classList.remove('active');
        updateStatus(`Modal cerrado: ${modalId}`);
    }
}

// VISTAS
function updateTodayView() {
    const taken = appData.medications.filter(m => m.taken).length;
    const pending = appData.medications.filter(m => !m.taken).length;
    
    document.getElementById('taken-count').textContent = taken;
    document.getElementById('pending-count').textContent = pending;
    document.getElementById('missed-count').textContent = 0;
    
    const container = document.getElementById('today-medications-list');
    const todaysMeds = appData.medications.filter(m => m.frequency === 'daily');
    
    container.innerHTML = todaysMeds.map(med => `
        <div class="medication-card ${med.taken ? 'taken' : ''}" data-id="${med.id}">
            <div class="med-info">
                <div class="med-name">${med.name}</div>
                <div class="med-dose">${med.dose} - ${med.instructions}</div>
                <div class="med-time">${med.time}</div>
            </div>
            ${!med.taken ? `<button class="btn btn-success take-med-btn" data-med-id="${med.id}">
                <i class="fas fa-check"></i> Tomar Ahora
            </button>` : ''}
        </div>
    `).join('');
}

function updateMedicinesView() {
    const container = document.getElementById('medicines-grid');
    let filteredMeds = appData.medications;
    
    if (currentFilter !== 'all') {
        filteredMeds = appData.medications.filter(med => {
            switch(currentFilter) {
                case 'active':
                    return !isExpired(med);
                case 'expiring':
                    return isExpiring(med);
                case 'expired':
                    return isExpired(med);
                default:
                    return true;
            }
        });
    }
    
    container.innerHTML = filteredMeds.map(med => `
        <div class="medication-grid-card">
            <div class="med-info">
                <div class="med-name">${med.name}</div>
                <div class="med-dose">${med.dose}</div>
                <div class="med-time">${med.time} - ${getFrequencyText(med.frequency)}</div>
                ${med.instructions ? `<div style="margin:10px 0;color:#666">${med.instructions}</div>` : ''}
                ${med.expiry ? `<div style="color:${isExpired(med) ? '#dc2626' : isExpiring(med) ? '#f59e0b' : '#10b981'}">
                    <i class="fas fa-calendar"></i> Vence: ${formatDate(med.expiry)}
                </div>` : ''}
            </div>
            <div class="medication-actions">
                <button class="btn btn-success take-med-btn" data-med-id="${med.id}">
                    <i class="fas fa-check"></i> Tomar
                </button>
                <button class="btn btn-warning edit-med-btn" data-med-id="${med.id}">
                    <i class="fas fa-edit"></i> Editar
                </button>
                <button class="btn btn-danger delete-med-btn" data-med-id="${med.id}">
                    <i class="fas fa-trash"></i> Eliminar
                </button>
            </div>
        </div>
    `).join('');
}

function updateReportsView() {
    updateAdherenceText();
    
    const weeklyContainer = document.getElementById('weekly-stats');
    const weekStats = generateWeeklyStats();
    weeklyContainer.innerHTML = weekStats.map(day => `
        <div style="display:inline-block;background:#f3f4f6;padding:15px;margin:5px;border-radius:10px;text-align:center;min-width:100px">
            <div style="font-weight:bold;color:#2563EB">${day.day}</div>
            <div style="font-size:1.5em;color:${day.color}">${day.percentage}%</div>
            <div style="font-size:0.9em;color:#666">${day.taken}/${day.total}</div>
        </div>
    `).join('');
    
    const alertsContainer = document.getElementById('alerts-list');
    const alerts = generateAlerts();
    alertsContainer.innerHTML = alerts.length > 0 ? alerts.map(alert => `
        <div style="padding:15px;margin:10px 0;border-radius:10px;background:${alert.bgColor};border-left:4px solid ${alert.color}">
            <div style="display:flex;align-items:center;gap:10px">
                <i class="fas fa-${alert.icon}" style="color:${alert.color};font-size:1.2em"></i>
                <div>
                    <div style="font-weight:bold;color:${alert.color}">${alert.title}</div>
                    <div style="color:#666">${alert.message}</div>
                </div>
            </div>
        </div>
    `).join('') : `
        <div style="text-align:center;padding:30px;color:#10b981">
            <i class="fas fa-check-circle" style="font-size:2em"></i>
            <p>¬°Excelente! No hay alertas importantes</p>
        </div>
    `;
}

function updateProfileView() {
    document.getElementById('patient-name').value = appData.patient.name || '';
    document.getElementById('patient-age').value = appData.patient.age || '';
    document.getElementById('patient-conditions').value = appData.patient.conditions || '';
}

function updateAdherenceText() {
    const container = document.getElementById('adherence-text');
    
    if (container) {
        const weekDays = ['Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b', 'Dom'];
        const adherenceText = weekDays.map((day, index) => {
            const taken = Math.floor(Math.random() * 4);
            const total = 3;
            const percentage = Math.round((taken / total) * 100);
            
            return `${day} ${percentage}% ${taken}/${total}`;
        }).join('<br>');
        
        container.innerHTML = `
            <div style="background:#f8fafc;padding:25px;border-radius:12px;border-left:4px solid #2563EB">
                <div style="font-size:1.2em;line-height:1.8;color:#1f2937">
                    ${adherenceText}
                </div>
            </div>
        `;
    }
}

function updateTodayDate() {
    const today = new Date();
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    document.getElementById('today-date').textContent = today.toLocaleDateString('es-ES', options);
}

// UTILIDADES
function getFrequencyText(frequency) {
    const texts = {
        'daily': 'Diario',
        'twice-daily': '2 veces al d√≠a',
        'weekly': 'Semanal',
        'as-needed': 'Seg√∫n necesidad'
    };
    return texts[frequency] || frequency;
}

function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('es-ES', { year: 'numeric', month: 'short', day: 'numeric' });
}

function isExpired(med) {
    if (!med.expiry) return false;
    return new Date(med.expiry) < new Date();
}

function isExpiring(med) {
    if (!med.expiry) return false;
    const expiryDate = new Date(med.expiry);
    const today = new Date();
    const daysUntilExpiry = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
    return daysUntilExpiry <= 30 && daysUntilExpiry > 0;
}

function generateWeeklyStats() {
    const days = ['Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b', 'Dom'];
    return days.map((day) => {
        const taken = Math.floor(Math.random() * 4);
        const total = 3;
        const percentage = Math.round((taken / total) * 100);
        let color = '#10b981';
        if (percentage < 50) color = '#dc2626';
        else if (percentage < 80) color = '#f59e0b';
        
        return { day, taken, total, percentage, color };
    });
}

function generateAlerts() {
    const alerts = [];
    
    appData.medications.forEach(med => {
        if (isExpired(med)) {
            alerts.push({
                type: 'error',
                icon: 'exclamation-triangle',
                color: '#dc2626',
                bgColor: '#fef2f2',
                title: 'Medicamento Vencido',
                message: `${med.name} ha vencido. No lo uses.`
            });
        } else if (isExpiring(med)) {
            const daysLeft = Math.ceil((new Date(med.expiry) - new Date()) / (1000 * 60 * 60 * 24));
            alerts.push({
                type: 'warning',
                icon: 'clock',
                color: '#f59e0b',
                bgColor: '#fffbeb',
                title: 'Medicamento por Vencer',
                message: `${med.name} vence en ${daysLeft} d√≠as`
            });
        }
    });
    
    return alerts;
}

function saveData() {
    try {
        localStorage.setItem('meds-app-complete', JSON.stringify(appData));
    } catch (error) {
        console.log('Error guardando datos:', error);
    }
}

function loadSavedData() {
    try {
        const saved = localStorage.getItem('meds-app-complete');
        if (saved) {
            appData = JSON.parse(saved);
        }
    } catch (error) {
        console.log('Error cargando datos:', error);
    }
}

// CONFIGURACI√ìN DE EVENT LISTENERS
function setupEventListeners() {
    updateStatus('Configurando event listeners...');
    
    // NAVEGACI√ìN
    document.querySelectorAll('[data-section]').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            const section = btn.getAttribute('data-section');
            switchSection(section);
        });
    });
    
    // BOT√ìN SOS
    document.getElementById('sos-button').addEventListener('click', (e) => {
        e.preventDefault();
        showModal('sos-modal');
    });
    
    // AGREGAR MEDICAMENTO
    document.getElementById('add-medication-btn').addEventListener('click', (e) => {
        e.preventDefault();
        showModal('add-medication-modal');
    });
    
    // FILTROS DE MEDICAMENTOS
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            
            // Actualizar filtros visuales
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            currentFilter = btn.getAttribute('data-filter');
            updateMedicinesView();
        });
    });
    
    // TOMAR MEDICAMENTOS (event delegation)
    document.addEventListener('click', (e) => {
        if (e.target.classList.contains('take-med-btn') || e.target.closest('.take-med-btn')) {
            e.preventDefault();
            const btn = e.target.classList.contains('take-med-btn') ? e.target : e.target.closest('.take-med-btn');
            const medId = btn.getAttribute('data-med-id');
            takeMedication(medId);
        }
    });
    
    // CANCELAR MODALES
    document.getElementById('cancel-medication-btn').addEventListener('click', (e) => {
        e.preventDefault();
        closeModal('add-medication-modal');
    });
    
    document.getElementById('cancel-contact-btn').addEventListener('click', (e) => {
        e.preventDefault();
        closeModal('add-contact-modal');
    });
    
    document.getElementById('cancel-sos-btn').addEventListener('click', (e) => {
        e.preventDefault();
        closeModal('sos-modal');
    });
    
    // FORMULARIOS
    document.getElementById('medication-form').addEventListener('submit', (e) => {
        e.preventDefault();
        updateStatus('Guardando medicamento...');
        
        const med = {
            id: Date.now().toString(),
            name: document.getElementById('med-name').value,
            dose: document.getElementById('med-dose').value,
            frequency: document.getElementById('med-frequency').value,
            time: document.getElementById('med-time').value,
            instructions: document.getElementById('med-instructions').value,
            expiry: document.getElementById('med-expiry').value,
            taken: false
        };
        
        appData.medications.push(med);
        showToast(`${med.name} agregado exitosamente`, 'success');
        closeModal('add-medication-modal');
        
        updateTodayView();
        updateMedicinesView();
        saveData();
        
        document.getElementById('medication-form').reset();
        updateStatus('‚úÖ Medicamento guardado');
    });
    
    document.getElementById('patient-form').addEventListener('submit', (e) => {
        e.preventDefault();
        
        appData.patient = {
            name: document.getElementById('patient-name').value,
            age: document.getElementById('patient-age').value,
            conditions: document.getElementById('patient-conditions').value
        };
        
        showToast('Informaci√≥n guardada exitosamente', 'success');
        saveData();
    });
    
    // CERRAR MODALES AL HACER CLIC FUERA
    document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.remove('active');
            }
        });
    });
    
    // PESTA√ëAS
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            
            const tabName = btn.getAttribute('data-tab');
            
            // Actualizar botones
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Mostrar contenido
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${tabName}-tab`).classList.add('active');
        });
    });
    
    updateStatus('‚úÖ Event listeners configurados');
}

// INICIALIZACI√ìN
function init() {
    updateStatus('Iniciando aplicaci√≥n...');
    
    try {
        updateTodayView();
        updateMedicinesView();
        updateReportsView();
        updateProfileView();
        updateTodayDate();
        loadSavedData();
        setupEventListeners();
        
        updateStatus('‚úÖ Aplicaci√≥n lista');
        
        // Auto-guardar cada 30 segundos
        setInterval(saveData, 30000);
        
        // Guardar al salir
        window.addEventListener('beforeunload', saveData);
        
    } catch (error) {
        updateStatus(`‚ùå Error: ${error.message}`);
        console.error('Error:', error);
    }
}

// VERIFICACI√ìN DE FUNCIONES
function checkFunctions() {
    const functions = [
        'switchSection', 'takeMedication', 'showModal', 'closeModal',
        'updateTodayView', 'updateMedicinesView', 'updateReportsView'
    ];
    
    functions.forEach(funcName => {
        if (typeof window[funcName] === 'function') {
            console.log(`‚úÖ ${funcName} disponible`);
        } else {
            console.log(`‚ùå ${funcName} NO disponible`);
        }
    });
}

// INICIO
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
        init();
        checkFunctions();
    });
} else {
    init();
    checkFunctions();
}
</script>
</body>
</html>